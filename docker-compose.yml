version: '3.8'
services:
    app:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: fipl-app
        ports:  # <-- Add this section
            - '1080:8000'  # HostPort:ContainerPort
        volumes:
            - ./:/var/www:cached
            - /var/www/vendor
            - /var/www/node_modules
        working_dir: /var/www
        command: >
            sh -c "
                composer install --optimize-autoloader --no-interaction &&
                php artisan optimize:clear &&
                php artisan serve --host=0.0.0.0 --port=8000
            "
        depends_on:
            - db

    db:
        image: 'mysql:8.0'
        container_name: fipl-db
        restart: unless-stopped
        environment:
            MYSQL_ROOT_PASSWORD: root
            MYSQL_DATABASE: fiplDB
            MYSQL_USER: fiplUser
            MYSQL_PASSWORD: secretFiplJobs
        ports:
            - '3317:3306'
        volumes:
            - 'dbdata:/var/lib/mysql'

volumes:
    dbdata: